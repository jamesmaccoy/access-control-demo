"use strict";(self.webpackChunkpayload_access_control_demo=self.webpackChunkpayload_access_control_demo||[]).push([[771],{59771:(e,a,l)=>{l.r(a),l.d(a,{default:()=>b});var t=l(67294),i=l(16550),s=l(9980),o=l(28630),n=l(75091),d=l(47489),r=l(2143),c=l(88348),u=l(83780);const f=(e,a)=>a?e.fields.filter((e=>(0,u.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var p=l(19826),v=l(40684),m=l(45074),$=l(91455),h=l(30894);const b=e=>{var a,l,u;const{collection:b,isEditing:E}=e,{slug:S,labels:{plural:g},admin:{useAsTitle:k,components:{views:{Edit:w}={}}={}}={}}=b,[C]=(0,t.useState)((()=>f(b,E))),[_]=(0,t.useState)((()=>({...b,fields:C}))),[P,Z]=(0,t.useState)(),y=(0,v.bU)(),{serverURL:L,routes:{admin:U,api:A}}=(0,s.Z)(),{params:{id:D}={}}=(0,i.$B)(),{state:N}=(0,i.TH)(),R=(0,i.k6)(),{setStepNav:T}=(0,n.FP)(),[x,B]=(0,t.useState)(),{permissions:F,user:G}=(0,o.a)(),{getVersions:H,preferencesKey:K}=(0,m.x5)(),{getPreference:V}=(0,$.G)(),j=(0,t.useCallback)((async e=>{var a;if(H(),E){const a=await(0,p.Z)({fieldSchema:_.fields,data:e.doc,user:G,id:D,operation:"update",locale:y});B(a)}else Z(`${U}/collections/${_.slug}/${null===(a=null==e?void 0:e.doc)||void 0===a?void 0:a.id}`)}),[U,_,E,H,G,D,y]),[{data:q,isLoading:z,isError:I}]=(0,d.Z)(E?`${L}${A}/${S}/${D}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),J=(null==N?void 0:N.data)||q;if((0,t.useEffect)((()=>{const e=[{url:`${U}/collections/${S}`,label:g}];if(E){let a="";J&&(a=k?J[k]?J[k]:"[Untitled]":J.id),e.push({label:a})}else e.push({label:"Create New"});T(e)}),[T,E,g,J,S,k,U]),(0,t.useEffect)((()=>{if(z)return;(async()=>{const e=await(0,p.Z)({fieldSchema:C,data:J,user:G,operation:E?"update":"create",id:D,locale:y});await V(K),B(e)})()}),[J,C,E,D,G,y,z,K,V]),(0,t.useEffect)((()=>{P&&R.push(P)}),[R,P]),I)return t.createElement(i.l_,{to:`${U}/not-found`});const M=null===(a=null==F?void 0:F.collections)||void 0===a?void 0:a[S],O=`${L}${A}/${S}/${D}${_.versions.drafts?"?draft=true":""}`,Q=`${L}${A}/${S}${E?`/${D}`:""}?locale=${y}&depth=0&fallback-locale=null`,W=E&&(null===(l=null==M?void 0:M.update)||void 0===l?void 0:l.permission)||!E&&(null===(u=null==M?void 0:M.create)||void 0===u?void 0:u.permission);return t.createElement(h.f.Provider,{value:1},t.createElement(r.Z,{DefaultComponent:c.Z,CustomComponent:w,componentProps:{id:D,isLoading:!x,data:J,collection:_,permissions:M,isEditing:E,onSave:j,initialState:x,hasSavePermission:W,apiURL:O,action:Q}}))}}}]);